"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[366],{73480:function(le,T,a){a.r(T),a.d(T,{default:function(){return ee}});var $=a(15009),d=a.n($),R=a(97857),h=a.n(R),z=a(99289),x=a.n(z),W=a(5574),b=a.n(W),B=a(13419),G=a(2618),i=a(80854);function H(f,t){return j.apply(this,arguments)}function j(){return j=x()(d()().mark(function f(t,o){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,i.request)("/api/login/captcha",h()({method:"GET",params:h()({},t)},o||{})));case 1:case"end":return v.stop()}},f)})),j.apply(this,arguments)}var V=a(87547),F=a(94149),E=a(24454),D=a(84942),S=a(5966),K=a(16434),J=a(63434),Q=a(38925),L=a(45360),X=a(48096),Y=a(67610),Z=a(67294),k=a(73935),q=a(409),e=a(85893),C=(0,q.kc)(function(f){var t=f.token;return{action:{marginLeft:"8px",color:"rgba(0, 0, 0, 0.2)",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"color 0.3s","&:hover":{color:t.colorPrimaryActive}},lang:{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:t.borderRadius,":hover":{backgroundColor:t.colorBgTextHover}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto"}}}),ue=function(){var t=C(),o=t.styles;return _jsxs(_Fragment,{children:[_jsx(AlipayCircleOutlined,{className:o.action},"AlipayCircleOutlined"),_jsx(TaobaoCircleOutlined,{className:o.action},"TaobaoCircleOutlined"),_jsx(WeiboCircleOutlined,{className:o.action},"WeiboCircleOutlined")]})},ce=function(){var t=C(),o=t.styles;return _jsx("div",{className:o.lang,"data-lang":!0,children:SelectLang&&_jsx(SelectLang,{})})},I=function(t){var o=t.content;return(0,e.jsx)(Q.Z,{style:{marginBottom:24},message:o,type:"error",showIcon:!0})},_=function(){var t=(0,Z.useState)({}),o=b()(t,2),P=o[0],v=o[1],ae=(0,Z.useState)("account"),U=b()(ae,2),M=U[0],se=U[1],O=(0,i.useModel)("@@initialState"),y=O.initialState,te=O.setInitialState,re=C(),ne=re.styles,l=(0,i.useIntl)(),ie=function(){var m=x()(d()().mark(function n(u){var s,c;return d()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("fetchUserInfo",u),p.next=3,y==null||(s=y.fetchUserInfo)===null||s===void 0?void 0:s.call(y);case 3:c=p.sent,c&&(0,k.flushSync)(function(){te(function(N){return h()(h()({},N),{},{currentUser:u})})});case 5:case"end":return p.stop()}},n)}));return function(u){return m.apply(this,arguments)}}(),oe=function(){var m=x()(d()().mark(function n(u){var s,c,g,p;return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,G.x4)(h()(h()({},u),{},{type:M}));case 3:if(s=r.sent,!s.data){r.next=15;break}return c=l.formatMessage({id:"pages.login.success",defaultMessage:"login successful!"}),L.ZP.success(c),localStorage.setItem("_bec_access_token",s.data.access_token),localStorage.setItem("_bec_email",s.data.email),localStorage.setItem("_bec_renewal_token",s.data.renewal_token),r.next=12,ie(s.data);case 12:return g=new URL(window.location.href).searchParams,i.history.push(g.get("redirect")||"/"),r.abrupt("return");case 15:console.log(s),v(s),r.next=24;break;case 19:r.prev=19,r.t0=r.catch(0),p=l.formatMessage({id:"pages.login.failure",defaultMessage:"Login failed, please try again!"}),console.log(r.t0),L.ZP.error(p);case 24:case"end":return r.stop()}},n,null,[[0,19]])}));return function(u){return m.apply(this,arguments)}}(),w=P.status,A=P.type;return(0,e.jsxs)("div",{className:ne.container,children:[(0,e.jsx)(i.Helmet,{children:(0,e.jsxs)("title",{children:[l.formatMessage({id:"menu.login",defaultMessage:"Login page"}),"- ",Y.Z.title]})}),(0,e.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,e.jsxs)(D.U,{submitter:{searchConfig:{submitText:"Login"}},contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,e.jsx)("img",{alt:"logo",src:"/logo.svg"}),title:"BeamEcho",subTitle:l.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},onFinish:function(){var m=x()(d()().mark(function n(u){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,oe(u);case 2:case"end":return c.stop()}},n)}));return function(n){return m.apply(this,arguments)}}(),children:[(0,e.jsx)(X.Z,{activeKey:M,onChange:se,centered:!0,items:[{key:"account",label:l.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"Account password login"})}]}),w==="error"&&A==="account"&&(0,e.jsx)(I,{content:l.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"Wrong account or password (admin/ant.design)"})}),M==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(S.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(V.Z,{})},placeholder:l.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"username: admin or user"}),rules:[{required:!0,message:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"please enter user name!"})}]}),(0,e.jsx)(S.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(F.Z,{})},placeholder:l.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"password: ant.design"}),rules:[{required:!0,message:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"Please enter your password!"})}]})]}),w==="error"&&A==="mobile"&&(0,e.jsx)(I,{content:"Verification code error"}),M==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(S.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(E.Z,{})},name:"mobile",placeholder:l.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"Phone number"}),rules:[{required:!0,message:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"Please enter phone number!"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"Malformed phone number!"})}]}),(0,e.jsx)(K.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(F.Z,{})},captchaProps:{size:"large"},placeholder:l.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"please enter verification code"}),captchaTextRender:function(n,u){return n?"".concat(u," ").concat(l.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"get verification code"})):l.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"get verification code"})},name:"captcha",rules:[{required:!0,message:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"please enter verification code!"})}],onGetCaptcha:function(){var m=x()(d()().mark(function n(u){var s;return d()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,H({phone:u});case 2:if(s=g.sent,s){g.next=5;break}return g.abrupt("return");case 5:L.ZP.success("Obtained verification code successfully! The verification code is: 1234");case 6:case"end":return g.stop()}},n)}));return function(n){return m.apply(this,arguments)}}()})]}),(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(J.Z,{noStyle:!0,name:"autoLogin",children:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"auto login"})}),(0,e.jsx)("a",{style:{float:"right"},children:(0,e.jsx)(i.FormattedMessage,{id:"pages.login.forgotPassword",defaultMessage:"forgotPassword"})})]})]})}),(0,e.jsx)(B.$_,{})]})},ee=_}}]);
